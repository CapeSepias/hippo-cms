(function(){function m(c,a,i,e){this.atOccurrence=!1;this.doc=c;null==e&&"string"==typeof a&&(e=!1);i=i?c.clipPos(i):j(0,0);this.pos={from:i,to:i};if("string"!=typeof a)a.global||(a=RegExp(a.source,a.ignoreCase?"ig":"g")),this.matches=function(n,f){if(n){a.lastIndex=0;for(var g=c.getLine(f.line).slice(0,f.ch),d=0,b,h;;){a.lastIndex=d;d=a.exec(g);if(!d)break;b=d;h=b.index;d=b.index+(b[0].length||1);if(d==g.length)break}(d=b&&b[0].length||0)||(0==h&&0==g.length?b=void 0:h!=c.getLine(f.line).length&&
d++)}else a.lastIndex=f.ch,g=c.getLine(f.line),d=(b=a.exec(g))&&b[0].length||0,h=b&&b.index,h+d!=g.length&&!d&&(d=1);if(b&&d)return{from:j(f.line,h),to:j(f.line,h+d),match:b}};else{e&&(a=a.toLowerCase());var k=e?function(c){return c.toLowerCase()}:function(c){return c},l=a.split("\n");this.matches=1==l.length?a.length?function(n,f){var g=k(c.getLine(f.line)),d=a.length,b;if(n?f.ch>=d&&-1!=(b=g.lastIndexOf(a,f.ch-d)):-1!=(b=g.indexOf(a,f.ch)))return{from:j(f.line,b),to:j(f.line,b+d)}}:function(){}:
function(a,f){var g=f.line,d=a?l.length-1:0,b=l[d],h=k(c.getLine(g)),e=a?h.indexOf(b)+b.length:h.lastIndexOf(b);if(!(a?e>f.ch||e!=b.length:e<f.ch||e!=h.length-b.length))for(;!(a?!g:g==c.lineCount()-1);){h=k(c.getLine(g+=a?-1:1));b=l[a?--d:++d];if(0<d&&d<l.length-1)if(h!=b)break;else continue;d=a?h.lastIndexOf(b):h.indexOf(b)+b.length;if(a?d!=h.length-b.length:d!=b.length)break;b=j(f.line,e);g=j(g,d);return{from:a?g:b,to:a?b:g}}}}}var j=CodeMirror.Pos;m.prototype={findNext:function(){return this.find(!1)},
findPrevious:function(){return this.find(!0)},find:function(c){function a(a){a=j(a,0);i.pos={from:a,to:a};return i.atOccurrence=!1}for(var i=this,e=this.doc.clipPos(c?this.pos.from:this.pos.to);;){if(this.pos=this.matches(c,e))return(!this.pos.from||!this.pos.to)&&console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(c){if(!e.line)return a(0);e=j(e.line-1,this.doc.getLine(e.line-1).length)}else{var k=this.doc.lineCount();if(e.line==k-1)return a(k);e=j(e.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},
to:function(){if(this.atOccurrence)return this.pos.to},replace:function(c){this.atOccurrence&&(c=CodeMirror.splitLines(c),this.doc.replaceRange(c,this.pos.from,this.pos.to),this.pos.to=j(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0)))}};CodeMirror.defineExtension("getSearchCursor",function(c,a,i){return new m(this.doc,c,a,i)});CodeMirror.defineDocExtension("getSearchCursor",function(c,a,i){return new m(this,c,a,i)})})();