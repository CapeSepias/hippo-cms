definitions:
  config:
    /hippo:configuration/hippo:update/hippo:registry/MoveTemplateTranslations:
      jcr:primaryType: hipposys:updaterinfo
      hipposys:batchsize: 10
      hipposys:description: Translations of template queries have been moved. Run
        this updater after upgrading to Hippo 11.
      hipposys:query: /jcr:root/hippo:configuration/hippo:queries/hippo:templates/element(*,
        hippostd:templatequery)
      hipposys:script: "package org.hippoecm.frontend.plugins.cms.admin.updater\r\n\
        \r\nimport org.onehippo.repository.update.BaseNodeUpdateVisitor\r\nimport\
        \ javax.jcr.Node\r\nimport org.hippoecm.repository.util.NodeIterable\r\n\r\
        \nclass UpdaterTemplate extends BaseNodeUpdateVisitor {\r\n  \r\n  private\
        \ Node templateBundles;\r\n  \r\n  public void initialize(Session session)\
        \ throws RepositoryException {\r\n    templateBundles = session.getNode(\"\
        /hippo:configuration/hippo:translations/hippo:templates\");\r\n  }\r\n\r\n\
        \  boolean doUpdate(Node node) {\r\n    if (node.isNodeType(\"hippo:translated\"\
        )) {\r\n      final String templateName = node.getName();\r\n      log.info\
        \ \"Moving translations of template ${templateName}\"\r\n      for (Node translation\
        \ : new NodeIterable(node.getNodes(\"hippo:translation\"))) {\r\n        final\
        \ String language = translation.getProperty(\"hippo:language\").getString();\r\
        \n        final String message = translation.getProperty(\"hippo:message\"\
        ).getString();\r\n        final Node templateBundle = getOrCreateTemplateResourceBundle(language);\r\
        \n        templateBundle.setProperty(templateName, message);\r\n        translation.remove();\r\
        \n      }\r\n      node.removeMixin(\"hippo:translated\");\r\n      return\
        \ true;\r\n    }\r\n    return false\r\n  }\r\n  \r\n  Node getOrCreateTemplateResourceBundle(String\
        \ language) {\r\n    if (templateBundles.hasNode(language)) {\r\n      return\
        \ templateBundles.getNode(language);\r\n    } else {\r\n      return templateBundles.addNode(language,\
        \ \"hipposys:resourcebundle\");\r\n    }\r\n  }\r\n\r\n  boolean undoUpdate(Node\
        \ node) {\r\n    throw new UnsupportedOperationException('Updater does not\
        \ implement undoUpdate method')\r\n  }\r\n\r\n}"
      hipposys:throttle: 1000
